pool:
  vmImage: "windows-latest"

variables:
  yarn_cache_folder: $(Pipeline.Workspace)/.yarn
  next_cache: $(System.DefaultWorkingDirectory)/.next/cache

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: "14.x"

  - script: yarn --frozen-lockfile
    displayName: Yarn Install

  - script: yarn audit --audit-level=high
    displayName: Yarn Audit

  - script: npm install -g win-node-env
    displayName: Install win-node-env

  - task: Cache@2
    inputs:
      key: next | $(Agent.OS) | yarn.lock
      path: $(next_cache)
    displayName: NextJS Cache

  - script: yarn build
    displayName: NextJS Build
